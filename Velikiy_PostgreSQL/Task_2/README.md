# üîß –ó–∞–¥–∞–Ω–∏–µ 2


# –û—Ç—á–µ—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é Task_2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ PostgreSQL

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#1-–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è](#2-—Ü–µ–ª–∏-–∑–∞–¥–∞–Ω–∏—è)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
4. [–•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç](#4-—Ö–æ–¥-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è-—Ä–∞–±–æ—Ç)
   - [4.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Master-—Å–µ—Ä–≤–µ—Ä–∞](#41-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-master-—Å–µ—Ä–≤–µ—Ä–∞)
   - [4.2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Replica —á–µ—Ä–µ–∑ pg_basebackup](#42-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è-replica-—á–µ—Ä–µ–∑-pg_basebackup)
   - [4.3. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞](#43-–∑–∞–ø—É—Å–∫-–∏-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å—Ç–∞—Ç—É—Å–∞)
   - [4.4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö](#44-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏-–¥–∞–Ω–Ω—ã—Ö)
5. [–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Ansible](#5-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è-—á–µ—Ä–µ–∑-ansible)
6. [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã](#6-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-—Ä–∞–±–æ—Ç—ã)
7. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#7-–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è **Task_2** –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å–∞ "–ö–ú–ë –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ". –†–∞–±–æ—Ç–∞ –ø–æ—Å–≤—è—â–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–æ—Ç–æ–∫–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (Streaming Replication) –≤ –°–£–ë–î PostgreSQL 16. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç–æ—á–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

–í—Å–µ —ç—Ç–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ansible.

---

## 2. –¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è

1.  –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø–µ—Ä–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (Master) –Ω–∞ –≤—Ç–æ—Ä–æ–π (Replica) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç—ã `pg_basebackup`.
2.  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É WAL-–ª–æ–≥–æ–≤ (Write-Ahead Logs) –æ—Ç Master –∫ Replica.
3.  –û–±–µ—Å–ø–µ—á–∏—Ç—å —Ä–∞–±–æ—Ç—É Replica –≤ —Ä–µ–∂–∏–º–µ "—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ" (Read-Only).
4.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –ø—É—Ç–µ–º —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Master –∏ –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–∞ Replica.

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

–†–∞–±–æ—Ç–∞ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ –¥–≤—É—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω:

| –†–æ–ª—å | –•–æ—Å—Ç | IP-–∞–¥—Ä–µ—Å | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –û–° | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|-----------------|----------|
| **Master** | `server1` | 192.168.122.19 | `urahoy-2` | –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Å–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| **Replica** | `server2` | 192.168.122.75 | `urahoy-1` | –°–µ—Ä–≤–µ—Ä-–∫–æ–ø–∏—è, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ —Ä–µ–∂–∏–º–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è |

**–°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**
```text
[ Master (192.168.122.19) ] 
       |
       | (WAL Stream / Port 5432)
       v
[ Replica (192.168.122.75) ]
```

---

## 4. –•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç

### 4.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Master-—Å–µ—Ä–≤–µ—Ä–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ `server1` –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ Ansible:

1.  **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`postgresql.conf`):**
    *   `wal_level = replica` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
    *   `max_wal_senders = 10` ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —Ä–µ–ø–ª–∏–∫.
    *   `wal_keep_size = 1GB` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ WAL-—Ñ–∞–π–ª–æ–≤ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏—è —Ä–µ–ø–ª–∏–∫–∏.
    *   `hot_standby = on` ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

2.  **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:**
    ```sql
    CREATE USER replicator WITH REPLICATION ENCRYPTED PASSWORD '...';
    ```

3.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (`pg_hba.conf`):**
    –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ, —Ä–∞–∑—Ä–µ—à–∞—é—â–µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `replicator` –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∏–∑ –ø–æ–¥—Å–µ—Ç–∏ —Ä–µ–ø–ª–∏–∫–∏:
    ```text
    host    replication     replicator    192.168.122.0/24    scram-sha-256
    ```

![alt text](photos/image.png)
*–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö Master-—Å–µ—Ä–≤–µ—Ä–∞.*

---

### 4.2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Replica —á–µ—Ä–µ–∑ pg_basebackup

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ `server2` –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–∞–Ω–Ω—ã—Ö:

1.  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É–∂–±—ã PostgreSQL –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/pg_data/16`.
2.  –ó–∞–ø—É—Å–∫ —É—Ç–∏–ª–∏—Ç—ã `pg_basebackup` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
    ```bash
    pg_basebackup -h 192.168.122.19 -U replicator -D /pg_data/16 -Fp -Xs -P -R
    ```
    *   `-h`: –∞–¥—Ä–µ—Å Master-—Å–µ—Ä–≤–µ—Ä–∞.
    *   `-U`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
    *   `-D`: —Ü–µ–ª–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö.
    *   `-Fp`: —Ñ–æ—Ä–º–∞—Ç Plain (–æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã).
    *   `-Xs`: —Å—Ç—Ä–∏–º–∏–Ω–≥ WAL-–ª–æ–≥–æ–≤ –≤–æ –≤—Ä–µ–º—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).
    *   `-P`: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
    *   `-R`: **–∫–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä**, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—â–∏–π —Ñ–∞–π–ª `standby.signal` –∏ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `primary_conninfo` –≤ —Ñ–∞–π–ª `postgresql.auto.conf`.


---

### 4.3. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–ª—É–∂–±–∞ PostgreSQL –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Master:**
–í—ã–ø–æ–ª–Ω–µ–Ω –∑–∞–ø—Ä–æ—Å –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é `pg_stat_replication` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫:
```sql
SELECT client_addr, state, sent_lsn, write_lsn, flush_lsn, replay_lsn 
FROM pg_stat_replication;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∑–Ω–∞—á–µ–Ω–∏–µ **`streaming`**, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É WAL-–ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `sent_lsn` –∏ `replay_lsn` –º–∏–Ω–∏–º–∞–ª—å–Ω–∞ (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–∞–≥–∞).

![alt text](image-1.png)
*–í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `pg_stat_replication`, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç 192.168.122.75.*

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Replica:**
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Ä–µ–ø–ª–∏–∫–∏:
```sql
SELECT pg_is_in_recovery();
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: t (true)
```
–ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å (CREATE TABLE) –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `cannot execute ... in a read-only transaction`, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º.

![alt text](photos/image-4.png)
*–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–µ—Ç –Ω–∞ –∑–∞–ø–∏—Å—å.*

---

### 4.4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —Å–µ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:

1.  **–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ Master:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏ –≤—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å–∏.
    ```sql
    CREATE TABLE IF NOT EXISTS repl_test (id serial PRIMARY KEY, created_at timestamp default now());
    INSERT INTO repl_test DEFAULT VALUES;
    ```

2.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Replica:** –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–π –∂–µ —Ç–∞–±–ª–∏—Ü—ã.
    ```sql
    SELECT * FROM repl_test;
    ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ Master, –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–∞ Replica –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–∑–∞–¥–µ—Ä–∂–∫–∞ ~ 1 —Å–µ–∫).

![alt text](photos/image-5.png)
*–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏: INSERT –Ω–∞ Master -> SELECT –Ω–∞ Replica.*

---

## 5. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Ansible

–í—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é playbook `postgresql_task2.yml`.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
*   **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å:** Playbook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ (Master –∏–ª–∏ Replica) –Ω–∞ –æ—Å–Ω–æ–≤–µ IP-–∞–¥—Ä–µ—Å–∞ (`when: ansible_host == master_ip`).
*   **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é, –∞ –ª–∏—à—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü–∞—Ä–æ–ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π Vault, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω–æ –º–µ—Ç–æ–¥–æ–º `scram-sha-256`.
*   **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º –±—ç–∫–∞–ø–æ–º –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:**
```bash
ansible-playbook -i inventory.ini postgresql_task2.yml --ask-vault-pass
```

---

## 6. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|----------|--------|
| –í–µ—Ä—Å–∏—è PostgreSQL | 16 | ‚úÖ |
| –£—Ä–æ–≤–µ–Ω—å WAL | `replica` | ‚úÖ |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ | `replicator` | ‚úÖ –°–æ–∑–¥–∞–Ω |
| –ú–µ—Ç–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ | `pg_basebackup -R` | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω |
| –°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | `streaming` | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω |
| –†–µ–∂–∏–º Replica | Read-Only | ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è **Task_2** –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ—Ç–æ–∫–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è PostgreSQL –º–µ–∂–¥—É –¥–≤—É–º—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏.

**–î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
1.  –†–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
2.  –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
3.  –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–∞—Ä–æ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP).
4.  –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–µ–ø–ª–∏–∫—É –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è.

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (High Availability).

---

 
*–î–∞—Ç–∞: 2026 | –ê–≤—Ç–æ—Ä: –¢–æ–≤–ø–µ–∫–æ –ì–ª–µ–± –í–∞–¥–∏–º–æ–≤–∏—á (@glebffff, telegram)*
